<!-- LOADER -->
<div class="loading-container" *ngIf="isLoader">
  <div class="spinner"></div>
  <div class="loading-text">
    Loading Products
    <span class="dots">
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </span>
  </div>
</div>

<!-- PRODUCTS TABLE -->
<div *ngIf="!isLoader">

  <!-- <div class="filters">
    <div class="search">
      <input type="text" placeholder="üîç Search by name or EAN code" [(ngModel)]="searchTerm"
        (input)="applyFilter(searchTerm)" />
    </div>

    <div class="filter-options">
      <select [(ngModel)]="searchTerm" (change)="filterProducts()">
        <option value="">All Categories</option>
        <option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </option>
      </select>

      <select [(ngModel)]="priceRange" (change)="filterProducts()">
        <option value="">All Prices</option>
        <option value="0-100">‚Çπ0 - ‚Çπ100</option>
        <option value="101-500">‚Çπ101 - ‚Çπ500</option>
        <option value="501-1000">‚Çπ501 - ‚Çπ1000</option>
        <option value="1001-5000">‚Çπ1001 - ‚Çπ5000</option>
        <option value="5001+">‚Çπ5001+</option>
      </select>

      <select [(ngModel)]="stockFilter" (change)="filterProducts()">
        <option value="">All Stock</option>
        <option value="inStock">In Stock</option>
        <option value="outOfStock">Out of Stock</option>
      </select>

      <select [(ngModel)]="sortBy" (change)="filterProducts()">
        <option value="name">Sort by Name</option>
        <option value="priceAsc">Price ‚Üë</option>
        <option value="priceDesc">Price ‚Üì</option>
      </select>
    </div>



  </div> -->
</div>
  <div class="toolbar" style="margin-top: 5%;">
    <!-- LEFT -->
    <div class="search left-icon">
      <input type="text" placeholder="üîç Search by name or EAN code" [(ngModel)]="searchTerm"
        (input)="applyFilter(searchTerm)" />
    </div>

   
    <!-- RIGHT GROUP -->
    <div class="right-actions">
       <img src="../../assets/plus-solid-full.svg" height="30" width="30" title="Add Single Product" alt="Add Products" (click)="showSidePanel = true" 
      style="cursor: pointer; margin-left: 15px;" />

       <img src="../../assets/images-solid-full.svg" height="30" width="30" title="Bulk Upload Images" alt="Upload Images" (click)="imageUpload = true" 
      style="cursor: pointer; margin-left: 15px;" />

      <img src="../../assets/arrow-up-from-bracket-solid-full.svg" height="30" width="30" title="Bulk Upload Products" alt="Upload Buk Products" 
        (click)="openUploadModal()" style="cursor: pointer;" />

      <mat-paginator [pageSize]="10" [pageSizeOptions]="[50, 100, 1000]" showFirstLastButtons>
      </mat-paginator>
    </div>
  </div>
<div class="table-container">


  <table mat-table [dataSource]="dataSource" class="elite-table" *ngIf="pagedProducts?.length">
    <!-- SELECT CHECKBOX -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox (change)="masterToggle()" [checked]="isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()">
        </mat-checkbox>
      </th>

      <td mat-cell *matCellDef="let row">
        <mat-checkbox (click)="$event.stopPropagation()" (change)="selection.toggle(row)"
          [checked]="selection.isSelected(row)">
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- EAN Code -->
    <ng-container matColumnDef="EANCode">
      <th mat-header-cell *matHeaderCellDef>EAN Code</th>
      <td mat-cell *matCellDef="let element">
        {{ element.EANCode }}
      </td>
    </ng-container>

    <!-- Name -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let element">
        {{ element.name }}
      </td>
    </ng-container>

    <!-- Category -->
    <ng-container matColumnDef="category">
      <th mat-header-cell *matHeaderCellDef>Category</th>
      <td mat-cell *matCellDef="let element">
        {{ element.category }}
      </td>
    </ng-container>

    <!-- Sell Type -->
    <ng-container matColumnDef="SellType">
      <th mat-header-cell *matHeaderCellDef>Sell Type</th>
      <td mat-cell *matCellDef="let element">
        {{ element.SellType }}
      </td>
    </ng-container>

    <!-- Quantity -->
    <ng-container matColumnDef="QuantityOnHand">
      <th mat-header-cell *matHeaderCellDef>Stock</th>
      <td mat-cell *matCellDef="let element">
        {{ element.QuantityOnHand }}
      </td>
    </ng-container>

    <!-- Price -->
    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef>Price</th>
      <td mat-cell *matCellDef="let element">
        ‚Çπ{{ element.price }}
      </td>
    </ng-container>

    <!-- Sale Price -->
    <ng-container matColumnDef="SalePrice">
      <th mat-header-cell *matHeaderCellDef>Sale Price</th>
      <td mat-cell *matCellDef="let element">
        ‚Çπ{{ element.SalePrice }}
      </td>
    </ng-container>

    <!-- ACTION -->
    <ng-container matColumnDef="action" sticky>
      <th mat-header-cell *matHeaderCellDef>Action</th>
      <td mat-cell *matCellDef="let element">
        <button mat-icon-button color="primary" (click)="openEditPanel(element)">
          <mat-icon>edit</mat-icon>
        </button>

        <button mat-icon-button color="warn" (click)="deleteProduct(element)">
          <mat-icon>delete</mat-icon>
        </button>

        <button mat-icon-button color="warn" (click)="deleteProduct(element)">
          <mat-icon>sync</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteProduct(element)">
          <mat-icon>sync_disabled</mat-icon>
        </button>

        <button mat-icon-button color="warn" *ngIf="element?.isImageUploaded" (click)="showimage(element)">
          <img src="../../assets/view_icon.svg" height="20px" width="20px" alt="delete"
            style="cursor: pointer; margin: 0px 5px;" />
        </button>

      </td>
    </ng-container>

    <!-- ROWS -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>


</div>



<!-- EMPTY STATE -->
<div class="empty-state" *ngIf="pagedProducts.length === 0">
  No products found
</div>

<!-- PAGINATION -->
<!-- <div class="pagination" *ngIf="totalPages > 1">
  <button (click)="setPage(currentPage - 1)" [disabled]="currentPage === 1">
    Prev
  </button>

  <span>Page {{ currentPage }} of {{ totalPages }}</span>

  <button (click)="setPage(currentPage + 1)" [disabled]="currentPage === totalPages">
    Next
  </button>
</div> -->

<!-- SIDE PANEL OVERLAY -->
<div class="side-panel-overlay" [class.active]="showSidePanel" (click)="closeSidePanel()"></div>

<!-- SIDE PANEL -->
<div class="side-panel" [class.active]="showSidePanel">
  <div class="side-panel-header">
    <h3>{{ editingProduct ? 'Edit Product' : 'Add Product' }}</h3>
    <button class="close-btn" (click)="closeSidePanel()">√ó</button>
  </div>

  <div class="side-panel-content">
    <form>

      <!-- <div class="form-group">
        <label>Product ID</label>
        <input type="text" [(ngModel)]="productForm.name" name="id" required />
      </div> -->

      <div class="form-group">
        <label>Name</label>
        <input type="text" [(ngModel)]="productForm.name" name="name" required />
      </div>

      <div class="form-group">
        <label>Category</label>
        <select [(ngModel)]="productForm.Category" name="Category">
          <option *ngFor="let c of categories" [value]="c.name">
            {{ c.name }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>MRP</label>
        <input type="number" [(ngModel)]="productForm.price" name="price" />
      </div>

      <div class="form-group">
        <label>Sale Price</label>
        <input type="number" [(ngModel)]="productForm.SalePrice" name="SalePrice" />
      </div>

      <div class="form-group">
        <label>EAN Code</label>
        <input type="text" [(ngModel)]="productForm.EANCode" name="EANCode" />
      </div>

      <div class="form-group">
        <label>Units In Hand</label>
        <input type="number" [(ngModel)]="productForm.quantity" name="quantity" />
      </div>
      <div class="form-group">
        <label>Sell Type</label>
        <select [(ngModel)]="productForm.SellType" name="SellType">
          <option *ngFor="let c of unitDesc" [value]="c">
            {{ c }}
          </option>
        </select>
      </div>
      <div class="form-actions">
        <button type="button" class="save-btn" (click)="onSave(productForm)">
          {{ editingProduct ? 'Update' : 'Save' }}
        </button>
        <button type="button" class="cancel-btn" (click)="closeSidePanel()">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- CONFIRM MODAL -->
<!-- <div class="modal-overlay" *ngIf="showModal">
  <div class="modal-content">
    <h3>Confirm Save</h3>
    <p>Are you sure?</p>
    <div class="modal-actions">
      <button (click)="confirmSave()">Yes</button>
      <button (click)="closeModal()">Cancel</button>
    </div>
  </div>
</div> -->


<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-content">
    <img [src]="'https://res.cloudinary.com/djbelgg05/image/upload/' + modalImageUrl + '.jpg'" alt="Product Image"
      class="modal-image" />
    <div class="modal-actions">
      <button (click)="closeModal()">Close</button>
    </div>
  </div>
</div>
<!-- Upload Modal -->
<div class="modal-overlay" *ngIf="bulkUploadModalOpen">
  <div class="upload-modal" style="width: 50%;">

    <h3 class="modal-title">Bulk Upload Products</h3>

    <!-- Upload Box -->
    <div class="upload-box" (click)="fileInput.click()">
      <input type="file" #fileInput hidden accept=".xlsx,.xls,.csv" (change)="productsInputChanged($event)" />

      <div *ngIf="!uploadedCSV">
        <div class="upload-icon">‚òÅÔ∏è</div>
        <div class="upload-text">
          <span class="highlight">Click to upload</span> or drag and drop
        </div>
        <div class="upload-subtext">
          Excel or CSV only
        </div>
      </div>

      <div *ngIf="uploadedCSV">
        <strong>{{ uploadedCSV.name }}</strong>
        <div class="upload-subtext">Ready to upload</div>
      </div>
    </div>

    <!-- Actions -->
    <div class="modal-actions">
      <button class="btn-outline" (click)="downloadTemplate()">
        Download Template
      </button>
  <button class="btn-primary" [disabled]="!uploadedCSV" (click)="isDataPresent = true; ">
        Preview File
      </button>
      <button class="btn-primary" [disabled]="!uploadedCSV" (click)="processBulkUpload()">
        Upload File
      </button>

      <button class="btn-danger" (click)="bulkUploadModalOpen = false">
        Cancel
      </button>
    </div>

  </div>
</div>
<div class="modal-overlay" *ngIf="isDataPresent">
  <div class="modal-content" style="width: 50%; max-height: 80vh; overflow-y: auto;">
    <h3>Preview Data</h3>
    <table class="preview-table"  style=" width: 100%; border-collapse: collapse; margin-bottom: 20px;">
      <thead style="background-color: rgb(83, 83, 83);color: white;">
        <tr>
          <th *ngFor="let header of previewHeaders">{{ header }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of previewData">
          <td *ngFor="let header of previewHeaders" style="border: 1px solid #ddd; padding: 8px;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;">{{ row[header] }}</td>
        </tr>
      </tbody>
    </table>
      <button class="btn-danger" (click)="isDataPresent = false">
        Cancel
      </button>
</div>
</div>
<div class="modal-overlay" *ngIf="imageUpload">
  <div class="upload-modal" style="width: 50%;">

    <h5 class="modal-title">Bulk Upload Images 

    </h5>

    <!-- Hidden File Input -->
    <input type="file" #fileInput accept="image/*" hidden (change)="onFileSelected($event)" />

    <!-- Upload Box -->
    <div class="upload-box" (click)="fileInput.click()" (dragover)="onDragOver($event)" (drop)="onDrop($event)">

      <!-- Image Preview -->
      <img *ngIf="previewUrl" [src]="previewUrl" class="image-preview" alt="Preview" />

      <!-- Upload Text -->
      <ng-container *ngIf="!previewUrl">
        <mat-icon class="upload-icon">cloud_upload</mat-icon>
        <p class="upload-text">
          <span class="highlight">Click to upload</span> or drag and drop
        </p>
        <p class="upload-subtext">
          SVG, PNG, JPG (MAX. 800√ó400px)
        </p>
      </ng-container>

    </div>

    <!-- Upload Button -->

    <div class="search" style="align-items: center; display: flex; margin-bottom: 16px;margin-top: 15px;gap: 8px;">
      <input type="text" placeholder="Enter Name of the image" [(ngModel)]="uploadName" (input)="filterProducts()" style="width: 60%;" />
       <button mat-raised-button color="primary" style="align-items: center;display: flex;align-content: center; margin-bottom: 16px;margin-top: 15px;" (click)="uploadImage()" [disabled]="!selectedFile">
      Upload Image
    </button>
    <button class="btn-danger" style="display: flex;align-content: right !important; margin-bottom: 16px;margin-top: 15px;" (click)="imageUpload = false">
        Cancel
      </button>
    </div>
   
    
  </div>
</div>
